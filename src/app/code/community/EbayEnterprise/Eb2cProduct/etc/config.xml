<?xml version="1.0" encoding="utf-8"?>
<!--
  Copyright (c) 2013-2014 eBay Enterprise, Inc.

  NOTICE OF LICENSE

  This source file is subject to the Open Software License (OSL 3.0)
  that is bundled with this package in the file LICENSE.md.
  It is also available through the world-wide-web at this URL:
  http://opensource.org/licenses/osl-3.0.php

  @copyright   Copyright (c) 2013-2014 eBay Enterprise, Inc. (http://www.ebayenterprise.com/)
  @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
-->
<config>
	<modules>
		<EbayEnterprise_Eb2cProduct>
			<version>1.2.2</version>
		</EbayEnterprise_Eb2cProduct>
	</modules>
	<global>
		<models>
			<eb2cproduct>
				<class>EbayEnterprise_Eb2cProduct_Model</class>
				<resourceModel>eb2cproduct_resource</resourceModel>
			</eb2cproduct>
			<eb2cproduct_resource>
				<class>EbayEnterprise_Eb2cProduct_Model_Resource</class>
			</eb2cproduct_resource>
		</models>
		<helpers>
			<eb2cproduct>
				<class>EbayEnterprise_Eb2cProduct_Helper</class>
			</eb2cproduct>
		</helpers>
		<resources>
			<eb2cproduct_setup>
				<setup>
					<module>EbayEnterprise_Eb2cProduct</module>
					<class>Mage_Catalog_Model_Resource_Setup</class>
				</setup>
			</eb2cproduct_setup>
		</resources>
		<events>
			<catalog_product_edit_action>
				<observers>
					<lock_readonly_attributes>
						<class>eb2cproduct/observers</class>
						<method>lockReadOnlyAttributes</method>
						<!--
								Unfortunately, there is no actual support for an <args>node. This
								would be the perfect place to list the attributes we wish to
								treat as readonly. But as of Tue May 6 2014, this is not really
								supported.

								Please search for readonly_attributes which are defined at
								eb2cproduct/readonly_attributes.
							-->
					</lock_readonly_attributes>
				</observers>
			</catalog_product_edit_action>
			<ebayenterprise_feed_dom_loaded>
				<observers>
					<eb2c_product_feed_dom>
						<class>eb2cproduct/observers</class>
						<method>processDom</method>
					</eb2c_product_feed_dom>
				</observers>
			</ebayenterprise_feed_dom_loaded>
			<product_feed_processing_complete>
				<observers>
					<eb2c_reindex_all>
						<class>eb2ccore/indexer</class>
						<method>reindexAll</method>
					</eb2c_reindex_all>
				</observers>
			</product_feed_processing_complete>
			<product_feed_complete_error_confirmation>
				<observers>
					<eb2c_error_confirmations>
						<class>eb2cproduct/error_confirmations</class>
						<method>process</method>
					</eb2c_error_confirmations>
				</observers>
			</product_feed_complete_error_confirmation>
			<product_feed_process_operation_type_error_confirmation>
				<observers>
					<eb2c_error_confirmations_operation>
						<class>eb2cproduct/error_confirmations</class>
						<method>processByOperationType</method>
					</eb2c_error_confirmations_operation>
				</observers>
			</product_feed_process_operation_type_error_confirmation>
			<filetransfer_import_complete>
				<observers>
					<eb2c_product_run_imports>
						<class>eb2cproduct/feed</class>
						<method>processFeeds</method>
						<type>model</type>
					</eb2c_product_run_imports>
				</observers>
			</filetransfer_import_complete>
		</events>
	</global>
	<default>
		<eb2ccore>
			<feed>
				<filetransfer_imports>
					<item_master>
						<local_directory>ExchangePlatform/Feed/inbox/product</local_directory>
						<event_type>ItemMaster</event_type>
						<header_version>2.3.0</header_version>
						<outbound>
							<message_header>
								<event_type>ItemMaster</event_type>
							</message_header>
						</outbound>
					</item_master>
					<content_master>
						<local_directory>ExchangePlatform/Feed/inbox/product</local_directory>
						<event_type>ContentMaster</event_type>
						<header_version>2.3.0</header_version>
						<outbound>
							<message_header>
								<event_type>ContentMaster</event_type>
							</message_header>
						</outbound>
					</content_master>
					<i_ship>
						<local_directory>ExchangePlatform/Feed/inbox/product</local_directory>
						<event_type>iShip</event_type>
						<header_version>2.3.0</header_version>
						<outbound>
							<message_header>
								<event_type>iShip</event_type>
							</message_header>
						</outbound>
					</i_ship>
					<item_pricing>
						<local_directory>ExchangePlatform/Feed/inbox/product</local_directory>
						<event_type>Pricing</event_type>
						<header_version>2.3.0</header_version>
						<outbound>
							<message_header>
								<event_type>Pricing</event_type>
							</message_header>
						</outbound>
					</item_pricing>
				</filetransfer_imports>
				<filetransfer_exports>
					<image_master>
						<xsd>CombinedProduct.xsd</xsd>
						<filename_format>{client_id}_{store_id}_{feed_type}_{time_stamp}_{current_store_id}.xml</filename_format>
						<event_type>ImageMaster</event_type>
						<outbound>
							<message_header>
								<event_type>ImageMaster</event_type>
							</message_header>
						</outbound>
					</image_master>
				</filetransfer_exports>
			</feed>
		</eb2ccore>
		<eb2cproduct>
			<!-- These attributes will display in the admin panel, but cannot be edited -->
			<readonly_attributes><![CDATA[hts_codes,is_clean,unresolved_product_links]]></readonly_attributes>
			<dummy>
				<!-- Default values for product attributes where Vanilla Magento doesn't already have defaults. -->
				<description>This product is invalid. If you are seeing this product, please do not attempt to purchase and contact customer service.</description>
				<in_stock>1</in_stock>
				<manage_stock>1</manage_stock>
				<short_description>invalid product. Please do not attempt to purchase.</short_description>
				<stock_quantity>0</stock_quantity>
				<type_id>simple</type_id>
				<weight>0</weight>
			</dummy>
			<api_service>product</api_service>
			<api_return_format>xml</api_return_format>
			<pim_export_feed>
				<cutoff_date/>
				<batch_size/>
			</pim_export_feed>
			<processor_delete_batch_size>200</processor_delete_batch_size>
			<processor_max_total_entries>200</processor_max_total_entries>
			<processor_update_batch_size>100</processor_update_batch_size>
			<attributes_code_list>color,size</attributes_code_list>
			<feed>
				<map>
					<ext_keys>brand_name,buyer_id,color,companion_flag,country_of_origin,gift_card_tender_code,hazardous_material_code,long_description,lot_tracking_indicator,ltl_freight_cost,may_ship_expedite,may_ship_international,may_ship_usps,msrp,price,safety_stock,sales_class,serial_number_type,ship_group,ship_window_max_hour,ship_window_min_hour,short_description,street_date,style_description,style_id,supplier_name,supplier_supplier_id</ext_keys>
					<ext_keys_bool>allow_gift_message,back_orderable,gift_wrap,gift_wrapping_available,is_hidden_product,service_indicator</ext_keys_bool>
				</map>
				<related_link_types>
					<es_accessory>related</es_accessory>
					<es_crossselling>crosssell</es_crossselling>
					<es_upselling>upsell</es_upselling>
				</related_link_types>
				<!--
				Mapping SalesClass possible values to a known value for Magento product stock item manage_stock attribute
				-->
				<stock_map>
					<stock>Yes</stock>
					<advanceOrderOpen>No</advanceOrderOpen>
					<advanceOrderLimited>Yes</advanceOrderLimited>
				</stock_map>
				<import_configuration>
					<xslt_deleted_sku>delete-template.xsl</xslt_deleted_sku>
					<deleted_base_xpath>sku</deleted_base_xpath>
					<xslt_default_template_path>default-language-template.xsl</xslt_default_template_path>
					<xslt_single_template_path>single-language-template.xsl</xslt_single_template_path>
					<base_item_xpath>/Items/Item</base_item_xpath>
					<all_skus_xpath>/Items/Item/ItemId/ClientItemId|/Items/Item/UniqueID|/Items/Item/ClientItemId</all_skus_xpath>
					<feed_type>product</feed_type>
					<xslt_module>EbayEnterprise_Eb2cProduct</xslt_module>
					<extractor_callback_path>eb2cproduct/feed_attribute_mappings</extractor_callback_path>
					<extractor_sku_xpath>ItemId/ClientItemId|UniqueID|ClientItemId</extractor_sku_xpath>
					<allowable_event_type>ItemMaster,ContentMaster,iShip,Pricing</allowable_event_type>
				</import_configuration>
			</feed>
			<feed_attribute_mappings>
				<attribute_set_id>
					<class>eb2cproduct/map</class>
					<type>helper</type>
					<method>extractAttributeSetValue</method>
					<xpath>CustomAttributes/Attribute[@name="AttributeSet"]/Value</xpath>
				</attribute_set_id>
				<category_ids>
					<class>eb2cproduct/map_category</class>
					<type>helper</type>
					<method>extractCategoryIds</method>
					<xpath>CategoryLinks/CategoryLink[@import_mode!="Delete"]/Name</xpath>
				</category_ids>
				<country_of_manufacture>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>extractStringValue</method>
					<xpath>ExtendedAttributes/CountryOfOrigin|BaseAttributes/CountryOfOrigin</xpath>
				</country_of_manufacture>
				<is_clean>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>passThrough</method>
					<xpath>0</xpath>
				</is_clean>
				<type_id>
					<class>eb2cproduct/map</class>
					<type>helper</type>
					<method>extractProductTypeValue</method>
					<xpath>CustomAttributes/Attribute[@name="ProductType"]/Value</xpath>
				</type_id>
				<sku>
					<class>eb2cproduct/map</class>
					<type>helper</type>
					<method>extractSkuValue</method>
					<xpath>ItemId/ClientItemId|UniqueID|ClientItemId</xpath>
				</sku>
				<style_id>
					<class>eb2cproduct/map</class>
					<type>helper</type>
					<method>extractSkuValue</method>
					<xpath>ExtendedAttributes/Style/StyleID|StyleID</xpath>
				</style_id>
				<tax_code>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>extractStringValue</method>
					<xpath>BaseAttributes/TaxCode</xpath>
				</tax_code>
				<unresolved_product_links>
					<class>eb2cproduct/map</class>
					<type>helper</type>
					<method>extractProductLinks</method>
					<xpath>ProductLinks/ProductLink</xpath>
				</unresolved_product_links>
				<name>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>extractStringValue</method>
					<xpath>BaseAttributes/Title</xpath>
				</name>
				<description>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>extractStringValue</method>
					<xpath>ExtendedAttributes/LongDescription</xpath>
				</description>
				<short_description>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>extractStringValue</method>
					<xpath>ExtendedAttributes/ShortDescription</xpath>
				</short_description>
				<price>
					<class>eb2cproduct/map_price</class>
					<type>helper</type>
					<method>extractPrice</method>
					<xpath>Event</xpath>
				</price>
				<special_price>
					<class>eb2cproduct/map_price</class>
					<type>helper</type>
					<method>extractSpecialPrice</method>
					<xpath>Event</xpath>
				</special_price>
				<special_from_date>
					<class>eb2cproduct/map_price</class>
					<type>helper</type>
					<method>extractPriceEventFromDate</method>
					<xpath>Event</xpath>
				</special_from_date>
				<special_to_date>
					<class>eb2cproduct/map_price</class>
					<type>helper</type>
					<method>extractPriceEventToDate</method>
					<xpath>Event</xpath>
				</special_to_date>
				<msrp>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>extractFloatValue</method>
					<xpath>Event/MSRP</xpath>
				</msrp>
				<weight>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>extractFloatValue</method>
					<xpath>ExtendedAttributes/ItemDimension/Shipping/Mass/Weight</xpath>
				</weight>
				<status>
					<class>eb2cproduct/map</class>
					<type>helper</type>
					<method>extractStatusValue</method>
					<xpath>BaseAttributes/ItemStatus</xpath>
				</status>
				<visibility>
					<class>eb2cproduct/map</class>
					<type>helper</type>
					<method>extractVisibilityValue</method>
					<xpath>BaseAttributes/CatalogClass</xpath>
				</visibility>
				<tax_class_id>
					<class>eb2ccore/map</class>
					<type>helper</type>
					<method>passThrough</method>
					<xpath>0</xpath>
				</tax_class_id>
				<price_view>
					<class>eb2cproduct/map</class>
					<type>disabled</type>
					<method/>
					<xpath/>
				</price_view>
				<allow_open_amount>
					<class>eb2cproduct/map</class>
					<type>disabled</type>
					<method/>
					<xpath/>
				</allow_open_amount>
				<stock_data>
					<class>eb2cproduct/map_stock</class>
					<type>helper</type>
					<method>extractStockData</method>
					<xpath>ExtendedAttributes/SalesClass</xpath>
				</stock_data>
			</feed_attribute_mappings>
			<feed_pim_mapping>
				<!-- http://confluence.tools.us.gspt.net/display/v11dev/Outbound+Inbound+File+Naming+Convention -->
				<item_map>
					<file_pattern>{client_id}_{catalog_id}_{feed_type}_{time_stamp}.xml</file_pattern>
					<root_node>ItemMaster</root_node>
					<item_node>Item</item_node>
					<event_type>ItemMaster</event_type>
					<schema_location>ItemMasterV11.xsd</schema_location>
					<is_validate>true</is_validate>
				</item_map>
				<content_map>
					<!-- Event Type is ContentMaster, but file name has Content. -->
					<file_pattern>{client_id}_{catalog_id}_Content_{time_stamp}.xml</file_pattern>
					<root_node>ContentMaster</root_node>
					<item_node>Content</item_node>
					<event_type>ContentMaster</event_type>
					<schema_location>ContentFeedV11.xsd</schema_location>
					<is_validate>true</is_validate>
				</content_map>
				<price_map>
					<!-- Event Type is Pricing, but file name has Price. Double-checked. -->
					<file_pattern>{client_id}_{store_id}_{catalog_id}_Price_{time_stamp}.xml</file_pattern>
					<root_node>Prices</root_node>
					<item_node>PricePerItem</item_node>
					<event_type>Pricing</event_type>
					<schema_location>PriceEventV11.xsd</schema_location>
					<is_validate>true</is_validate>
				</price_map>
			</feed_pim_mapping>
		</eb2cproduct>
	</default>
	<crontab>
		<jobs>
			<eb2cproduct_pim_export_feed>
				<run>
					<model>eb2cproduct/pim_collector::runExport</model>
				</run>
			</eb2cproduct_pim_export_feed>
			<eb2cproduct_image_export_feed>
				<run>
					<model>eb2cproduct/image_export::process</model>
				</run>
			</eb2cproduct_image_export_feed>
		</jobs>
	</crontab>
	<phpunit>
		<suite>
			<modules>
				<EbayEnterprise_Eb2cProduct/>
			</modules>
		</suite>
	</phpunit>
</config>
